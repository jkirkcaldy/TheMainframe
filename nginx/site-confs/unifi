#UNIFI CONTROLLER

server {
        listen 80;
        server_name unifi.themainframe.co.uk;
        return 301 https://$server_name$request_uri;
	}

server {
        listen 443 ssl;
        server_name unifi.themainframe.co.uk;

## NOTE: If you use the strong-ssl.conf settings you need to remove HTTPOnly; from proxy_cookie_path / "/; HTTPOnly; Secure"; in strong-ssl.conf
#SSL settings
include /etc/nginx/ssl.conf;

	proxy_cache off;
        proxy_store off;

	#Organizr auth
	include /etc/nginx/serverauth-V2.conf; #For server-auth with Organizr, remove unless you use Organizr.

       location / {
		auth_request /auth-0; #For server-auth with Organizr, remove unless you use Organizr.
                proxy_pass https://10.10.0.13:8443/;
		proxy_cookie_domain $server_name $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header HOST $http_host;
                proxy_hide_header X-Frame-Options;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "upgrade";
        }
        location /ws/ {
                proxy_pass https://10.10.0.13:8443/ws/;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "upgrade";
        }
}

server {
        listen 80;
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name  cctv.themainframe.co.uk;

  include /etc/nginx/cloudflare.conf;

  include /etc/nginx/ssl.conf;


        # Logs
        access_log /var/log/nginx/uvc-access.log;
        error_log /var/log/nginx/uvc-error.log;




        location / {
                # Proxy
                      # Reverse Proxy
                proxy_redirect          off;
                proxy_pass_header       Server;
                proxy_set_header        X-Real-IP $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header        X-Scheme $scheme;
                proxy_set_header        Host $http_host;
                proxy_set_header        X-NginX-Proxy true;
                proxy_connect_timeout   5;
                proxy_read_timeout      240;
                proxy_intercept_errors  on;

                proxy_pass             http://10.10.0.13:7080/; #CHANGE THIS

## WebSockets
        location /ws/ {
    proxy_pass http://10.10.0.13:7080/ws/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}


        # Redirect to HTTPS
                  if ($scheme = http) {
                       return 301 https://$server_name$request_uri; #CHANGE THIS (uncomment) after cert installation
                  }
        }
}

server {
        listen 7446 ssl http2;

        server_name  cctv.themainframe.co.uk;                   #CHANGE THIS
        include /etc/nginx/ssl.conf;
        include /etc/nginx/cloudflare.conf;

        # Logs
        access_log /var/log/nginx/uvc-access.log; #CHANGE THIS
        error_log /var/log/nginx/uvc-error.log; #CHANGE THIS

## WebSockets
    location / {
    proxy_pass http://10.10.0.13:7445;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
        }

}
